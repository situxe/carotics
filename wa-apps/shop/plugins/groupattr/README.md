# Плагин groupattr для Shopscript 5/6

Этот плагин будет полезен для магазинов, товары в которых обладают большим количеством характеристик. Вместо сплошного списка всех характеристик подряд, можно разделить характеристики на группы, понятные покупателю. 

Плагин предоставляет хелпер, который можно вызвать из шаблона карточки товара, передав в качестве параметра товар и получить структурированный массив характеристик, распределенных по заранее указанным группам.

Небольшое изменение шаблона карточки товара в части отображения характеристик товара значительно улучшит восприятие покупателем всех особенностей и нюансов предлагаемого продукта.

**Внимание** плагин только для улучшения отображения характеристик в карточке товара. Никаких изменений в администрировании, редактировании товаров и характеристик не произойдет.

## Настройка

В настройках плагина выбрать нужный тип товара. Создать группу характеристик. Перетащить мышью характеристики в группу. Отсортировать характеристики в группе в нужном порядке. Отсортировать группы характеристик в нужном порядке. Сохранить. нажав кнопку рядом с выпадающим списком типов товаров.

## Вызов хелпера со страницы карточки товара
`{$gfeatures = shopGroupattrPlugin::process($product)}`

Теперь переменная `$gfeatures` содержит массив характеристик, разделенный на группы.

## Структура данных, возвращаемых хелпером

Первый элемент массива, с индексом 0, всегда содержит только ключ ‘features’, с массивом характеристик, не вошедших ни в одну группу.

У всех последующих элементов есть ключ ‘name’, который содержит название группы и ключ ‘features’, который содержит все характеристики группы.

    array(
        0 => array(
            'features' => array(/* массив характеристик, без групп*/)
        )
        1 => array(
            'name' => 'Название группы',
            'features' => array(/* массив характеристик в группе*/)
        )
        /* .... */
    )

## Изменения стандартного шаблона *default*

Файл product.html.

Найти строку `<!-- product features -->`

После нее, вплоть до строки `<!-- categories -->` все заменить на:

       {if $product.features}
           {$gfeatures = shopGroupattrPlugin::process($product)}
           {foreach $gfeatures as $fgroups}
               {if $fgroups@index > 0}{* Характеристики без группы самые первые, с индексом 0 и у них нет свойства name *}
                   <h4>{$fgroups.name}</h4>
               {/if}
               <table class="features">
                   {foreach $fgroups.features as $f_code => $f_value}
                       <tr{if $features[$f_code].type == 'divider'} class="divider"{/if}>
                           <td class="name">
                               {$features[$f_code].name|escape}
                           </td>
                           <td class="value" itemprop="{$f_code|escape}">
                               {if is_array($f_value)}
                                   {if $features[$f_code].type == 'color'}
                                       {implode('<br /> ', $f_value)}
                                   {else}
                                       {implode(', ', $f_value)}
                                   {/if}
                               {else}
                                   {$f_value}
                               {/if}
                           </td>
                       </tr>
                   {/foreach}
               </table>
           {/foreach}
         {/if}


## Автор
Сергей Родовниченко, <sergerod@gmail.com>


